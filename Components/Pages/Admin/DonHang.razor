@attribute [StreamRendering]
@rendermode InteractiveServer
@page "/admin/donhang"
@using BlazorStoreManagementWebApp.DTOs.Admin.DonHang
@using BlazorStoreManagementWebApp.Components.Forms.Admin
@using BlazorStoreManagementWebApp.Components.UI.Pagination
@layout Components.Layout.Admin.MainLayout

<div class="content-header">
    <h2>
        <i class="fas fa-shopping-cart"></i>
        Quản lý Đơn hàng
    </h2>
</div>

<div class="card p-3 shadow-sm" style="border-radius: 1em;">
    <div class="row g-3">

        <div class="col-md-2">
            <label>Tìm kiếm</label>
            <div class="input-group">
                <input @bind="InputFilter.Keyword"
                       type="text"
                       placeholder="Mã đơn / Tên khách..."
                       class="form-control" />
            </div>
        </div>

        <div class="col-md-2">
            <label>Từ ngày</label>
            <input @bind="InputFilter.StartDate" type="date" class="form-control" />
        </div>

        <div class="col-md-2">
            <label>Đến ngày</label>
            <input @bind="InputFilter.EndDate" type="date" class="form-control" />
        </div>

        <div class="col-md-2">
            <label>Min tổng tiền</label>
            <input @bind="InputFilter.MinPrice" type="number" class="form-control" placeholder="0" />
        </div>

        <div class="col-md-2">
            <label>Max tổng tiền</label>
            <input @bind="InputFilter.MaxPrice" type="number" class="form-control" placeholder="0" />
        </div>

        <div class="col-md-1 align-content-end">
            <button class="btn btn-primary w-100" @onclick="Search">
                <i class="fas fa-filter"></i> Lọc
            </button>
        </div>

        <div class="col-md-1 align-content-end">
            <button class="btn btn-secondary w-100" @onclick="ClearFilter">
                <i class="fas fa-undo"></i> Reset
            </button>
        </div>

    </div>
</div>

<div class="table-container mt-3">
    <table class="table">
        <thead>
            <tr>
                <th>Mã đơn</th>
                <th>Khách hàng</th>
                <th class="text-center">Ngày đặt</th>
                <th class="text-center">Tổng tiền</th>
                <th class="text-center">Trạng thái</th>
                <th class="text-center">Tùy chỉnh</th>
            </tr>
        </thead>

        <tbody>
            @if (DonHangData?.Data == null || !DonHangData.Data.Any())
            {
                <tr>
                    <td colspan="6" class="text-center text-muted py-4">
                        <i class="fas fa-box-open fa-2x mb-2"></i><br />
                        Không có dữ liệu
                    </td>
                </tr>
            }
            else
            {
                @foreach (var item in DonHangData.Data)
                {
                    <tr>
                        <td>#@item.OrderId</td>

                        <td>
                            <div class="fw-bold">@item.CustomerName</div>
                            <small class="text-muted">@item.Phone</small>
                        </td>

                        <td class="text-center">
                            @item.OrderDate?.ToString("yyyy-MM-dd HH:mm")
                        </td>

                        <td class="text-center fw-bold" style="color: #059669;">
                            @string.Format("{0:N0} VND", item.TotalAmount)
                        </td>

                        <td class="text-center">
                            @if (item.Status == "Completed")
                            {
                                <span class="badge bg-success">Đã thanh toán</span>
                            }
                            else
                            {
                                <span class="badge bg-warning text-dark">Chờ thanh toán</span>
                            }
                        </td>

                        <td class="text-center">
                            <button class="btn-action btn-edit"
                                    @onclick="() => OpenDetail(item.OrderId)"
                                    data-bs-toggle="modal"
                                    data-bs-target="#orderDetailModal">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>

@if (DonHangData?.Data != null && DonHangData.Data.Any())
{
    <PaginationAdmin Total="DonHangData.Total"
                     Page="@Page"
                     PageChanged="ChangePage"
                     PageSize="@PageSize" />
}

<ChiTietDonHangForm @ref="DonHangFormRef" OnSaved="LoadData" />