@page "/admin/thongke"
@using BlazorStoreManagementWebApp.Components.Forms.Admin
@attribute [StreamRendering]
@rendermode InteractiveServer
@using Components.Layout.Admin;
@layout MainLayout

<!-- Page Title -->
<div class="content-header">
    <h2>
        <i class="fas fa-chart-pie"></i>
        Thống kê doanh thu
    </h2>
</div>
<div class="dashboard-wrapper" style="display:flex; gap:1rem; flex-wrap:wrap;">

    <!-- Cột trái: Đơn hàng hôm nay -->
    <div class="orders-section-column" style="flex:1 1 300px; min-width:300px; min-height:500px;">
        <div class="orders-section">
            <h3 class="orders-title">Đơn hàng hôm nay</h3>
            <div class="orders-list">
                @if (TodayOrderList == null || TodayOrderList.Count == 0)
                {
                    <div class="order-item" style="text-align:center; padding:1rem; color:#6b7280;">
                        Hôm nay chưa có đơn hàng
                    </div>
                }
                else
                {
                    @foreach (var order in TodayOrderList)
                    {
                        <div class="order-item">
                            <div class="order-header">
                                <span class="order-id">@order.OrderId</span>
                                <span class="order-amount">₫ @order.TotalAmount</span>
                            </div>
                            <div class="order-details">
                                <span>@order.CustomerName</span>

                                <span class="status-badge status-@order.Status.ToLower()">
                                    @order.Status
                                </span>

                                <span>@order.OrderDate?.ToString("HH:mm")</span>
                            </div>
                        </div>
                    }
                }

            </div>
        </div>
    </div>

    <!-- Cột phải: Filter + KPI + Biểu đồ -->
    <div class="stats-column" style="flex:2 1 600px; min-width:400px; display:flex; flex-direction:column; gap:1rem;">

        <!-- Filter section -->
        <div class="filter-section" style="display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap;">
            <div class="filter-group">
                <label>Chọn chế độ</label>
                <select @onchange="OnModeChanged" class="form-control">
                    <option selected value="Month">Tháng</option>
                    <option value="Year">Năm</option>
                </select>
            </div>
            @if (SelectedMode == "Month")
            {
                <div class="filter-group">
                    <label>Tháng</label>
                    <select @bind="SelectedMonth" class="form-control">
                        @foreach (var m in Months)
                        {
                            <option value="@m">@m</option>
                        }
                    </select>
                </div>
                <div class="filter-group">
                    <label>Năm</label>
                    <select @bind="SelectedYear" class="form-control">
                        @foreach (var y in Years)
                        {
                            <option value="@y">@y</option>
                        }
                    </select>
                </div>
            }
            else if (SelectedMode == "Year")
            {
                <div class="filter-group">
                    <label>Năm</label>
                    <select @bind="SelectedYear" class="form-control">
                        @foreach (var y in Years)
                        {
                            <option value="@y">@y</option>
                        }
                    </select>
                </div>
            }

            <div class="filter-group">
                <button class="btn btn-primary" @onclick="ApplyFilter">Áp dụng</button>
            </div>
        </div>

        <!-- Biểu đồ -->
        <div class="chart-section">
            <h3 class="chart-title">Doanh thu theo @(SelectedMode == "Month" ? "Ngày" : "Tháng")</h3>
            <!-- Replaced placeholder with canvas for Chart.js bar chart -->
            <div class="chart-container">
                <canvas id="revenueChart"></canvas>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="kpi-container">
            <!-- Revenue Card -->
            <div class="kpi-card">
                <div class="kpi-header">
                    <span class="kpi-title">Tổng doanh thu</span>
                    <div class="kpi-icon revenue">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                </div>
                <div class="kpi-value">₫ @TotalRevenue</div>
                <div class="kpi-change up">
                    <i class="fas fa-arrow-up"></i> 15% so với tháng trước
                </div>
            </div>

            <!-- Cost Card -->
            <div class="kpi-card">
                <div class="kpi-header">
                    <span class="kpi-title">Tổng vốn nhập hàng</span>
                    <div class="kpi-icon cost">
                        <i class="fas fa-box"></i>
                    </div>
                </div>
                <div class="kpi-value">₫ @TotalCapital</div>
                <div class="kpi-change down">
                    <i class="fas fa-arrow-down"></i> 5% so với tháng trước
                </div>
            </div>

            <!-- Profit Card -->
            <div class="kpi-card">
                <div class="kpi-header">
                    <span class="kpi-title">Tổng lãi</span>
                    <div class="kpi-icon profit">
                        <i class="fas fa-chart-line"></i>
                    </div>
                </div>
                <div class="kpi-value">₫ @TotalProfit</div>
                <div class="kpi-change up">
                    <i class="fas fa-arrow-up"></i> 25% so với tháng trước
                </div>
            </div>
        </div>

    </div>
</div>
