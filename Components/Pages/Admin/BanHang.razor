@attribute [StreamRendering]
@rendermode InteractiveServer
@page "/admin/banhang"
@using Components.Layout.Admin;
@layout MainLayout

<div class="pos-container" id="posContainer">
    <!-- BÊN TRÁI: DANH SÁCH SẢN PHẨM + CHỌN KHÁCH HÀNG -->
    <div class="products-section">
        <!-- Product list section -->
        <div>
            <h3 class="section-title">
                <i class="fas fa-boxes"></i>
                Danh sách sản phẩm
            </h3>

            <!--Bộ lọc và tìm kiếm -->
            <div class="filter-bar">
                <input type="text" 
                       id="searchProduct" 
                       placeholder="🔍 Tìm kiếm sản phẩm..."
                       @bind="Keyword" />
                <select id="filterCategory" @bind="CategoryID">
                    <option value="">Tất cả loại</option>
                    @foreach (var category in LSPData)
                    {
                        <option value="@category.CategoryId">@category.CategoryName</option>
                    }
                </select>
            </div>

            <!-- Danh sách sản phẩm -->
            <div class="products-grid" id="productsGrid">
                <!-- Sản phẩm mẫu -->
                <div class="product-card" onclick="addToCart(1, 'iPhone 15 Pro Max', 29990000)">
                    <div class="product-image">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <div class="product-name">iPhone 15 Pro Max</div>
                    <div class="product-price">29.990.000₫</div>
                </div>

                <div class="product-card" onclick="addToCart(2, 'Samsung Galaxy S24', 22990000)">
                    <div class="product-image">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <div class="product-name">Samsung Galaxy S24</div>
                    <div class="product-price">22.990.000₫</div>
                </div>

                <div class="product-card" onclick="addToCart(3, 'MacBook Pro M3', 45990000)">
                    <div class="product-image">
                        <i class="fas fa-laptop"></i>
                    </div>
                    <div class="product-name">MacBook Pro M3</div>
                    <div class="product-price">45.990.000₫</div>
                </div>

                <div class="product-card" onclick="addToCart(4, 'Dell XPS 15', 35990000)">
                    <div class="product-image">
                        <i class="fas fa-laptop"></i>
                    </div>
                    <div class="product-name">Dell XPS 15</div>
                    <div class="product-price">35.990.000₫</div>
                </div>

                <div class="product-card" onclick="addToCart(5, 'iPad Pro 12.9', 28990000)">
                    <div class="product-image">
                        <i class="fas fa-tablet-alt"></i>
                    </div>
                    <div class="product-name">iPad Pro 12.9</div>
                    <div class="product-price">28.990.000₫</div>
                </div>

                <div class="product-card" onclick="addToCart(6, 'AirPods Pro 2', 6990000)">
                    <div class="product-image">
                        <i class="fas fa-headphones"></i>
                    </div>
                    <div class="product-name">AirPods Pro 2</div>
                    <div class="product-price">6.990.000₫</div>
                </div>

                <div class="product-card" onclick="addToCart(7, 'Sony WH-1000XM5', 8990000)">
                    <div class="product-image">
                        <i class="fas fa-headphones"></i>
                    </div>
                    <div class="product-name">Sony WH-1000XM5</div>
                    <div class="product-price">8.990.000₫</div>
                </div>

                <div class="product-card" onclick="addToCart(8, 'Apple Watch Ultra', 21990000)">
                    <div class="product-image">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="product-name">Apple Watch Ultra</div>
                    <div class="product-price">21.990.000₫</div>
                </div>
            </div>
        </div>

        <!-- Customer and discount section at bottom -->
        <div class="customer-discount-section">
            <!-- Chọn khách hàng -->
            <div class="section-subtitle">
                <i class="fas fa-user-circle"></i>
                Thông tin khách hàng
            </div>

            <div class="customer-input-group">
                <input type="text" id="customerPhone" placeholder="Nhập số điện thoại khách hàng"
                        maxlength="10">
                <button class="find-customer-btn" onclick="findCustomer()">
                    <i class="fas fa-search"></i> Tìm khách hàng
                </button>
            </div>

            <!-- Customer info display -->
            <div class="customer-info-display" id="customerInfoDisplay">
                <div class="customer-name-display" id="customerNameDisplay">
                    <i class="fas fa-user-check"></i>
                    <span id="customerNameText"></span>
                </div>
                <div class="customer-points-display">
                    <span class="points-label">
                        <i class="fas fa-gift"></i> Điểm thưởng khả dụng
                    </span>
                    <span class="points-value" id="customerPointsValue">0 điểm</span>
                </div>
                <label class="use-points-checkbox">
                    <input type="checkbox" id="usePointsCheckbox" onchange="toggleUsePoints()">
                    <span>Sử dụng điểm thưởng (1 điểm = 1.000₫)</span>
                </label>
            </div>

            <!-- Discount code section -->
            <div class="section-subtitle" style="margin-top: 1rem;">
                <i class="fas fa-tag"></i>
                Mã giảm giá
            </div>

            <div class="discount-input-group">
                <input type="text" id="discountCode" placeholder="Nhập mã giảm giá (VD: GIAM10)">
                <button class="apply-discount-btn" onclick="applyDiscount()">
                    <i class="fas fa-ticket-alt"></i> Áp dụng
                </button>
            </div>
        </div>
    </div>

    <!-- Cart section - always visible -->
    <div class="cart-section" id="cartSection">
        <h3 class="section-title">
            <i class="fas fa-shopping-cart"></i>
            Đơn hàng
        </h3>

        <!-- Danh sách sản phẩm trong giỏ -->
        <div class="cart-items" id="cartItems">
            <div class="empty-cart">
                <i class="fas fa-shopping-basket"></i>
                <p>Chưa có sản phẩm nào</p>
            </div>
        </div>

        <!-- Order summary section -->
        <div class="order-summary">
            <div class="summary-row">
                <span class="label">Tạm tính:</span>
                <span class="amount" id="subtotal">0₫</span>
            </div>
            <div class="summary-row discount" id="discountRow" style="display: none;">
                <span class="label">Mã giảm giá:</span>
                <span class="amount" id="discount">0₫</span>
            </div>
            <div class="summary-row points-discount" id="pointsDiscountRow" style="display: none;">
                <span class="label">Điểm thưởng:</span>
                <span class="amount" id="pointsDiscount">0₫</span>
            </div>
            <div class="summary-row total">
                <span class="label">Tổng cộng:</span>
                <span class="amount" id="total">0₫</span>
            </div>
        </div>

        <!-- Payment methods -->
        <div class="payment-methods">
            <div class="payment-methods-label">
                <i class="fas fa-credit-card"></i> Phương thức thanh toán
            </div>
            <div class="payment-options">
                <div class="payment-option active" onclick="selectPayment(this, 'cash')">
                    <i class="fas fa-money-bill-wave"></i>
                    <div>Tiền mặt</div>
                </div>
                <div class="payment-option" onclick="selectPayment(this, 'card')">
                    <i class="fas fa-credit-card"></i>
                    <div>Thẻ</div>
                </div>
                <div class="payment-option" onclick="selectPayment(this, 'bank')">
                    <i class="fas fa-university"></i>
                    <div>Chuyển khoản</div>
                </div>
                <div class="payment-option" onclick="selectPayment(this, 'ewallet')">
                    <i class="fas fa-wallet"></i>
                    <div>Ví điện tử</div>
                </div>
            </div>
        </div>

        <!-- Checkout button -->
        <button class="checkout-btn" id="checkoutBtn" onclick="checkout()" disabled>
            <i class="fas fa-check-circle"></i> Thanh toán
        </button>
    </div>
</div>