@using BlazorStoreManagementWebApp.DTOs.Admin.NhanVien
@using BlazorStoreManagementWebApp.Services.Interfaces
@inject INhanVienService NhanVienService
@inject Blazored.SessionStorage.ISessionStorageService SessionStorage
@inject IJSRuntime JS

<div class="modal fade" id="ThongTinCaNhanModal" tabindex="-1" aria-labelledby="ThongTinCaNhanModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content" style="border: none; border-radius: 12px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);">
            <EditForm Model="@Model" OnValidSubmit="@HandleSubmit">
                <DataAnnotationsValidator />

                <!-- Header -->
                <div class="modal-header" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none;">
                    <h1 class="modal-title fs-5" id="ThongTinCaNhanModalLabel" style="color: white; font-weight: 700;">
                        <i class="fas fa-user-edit" style="margin-right: 0.5rem;"></i>
                        Thông tin cá nhân
                    </h1>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <!-- Body -->
                <div class="modal-body" style="padding: 2rem;">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label" style="font-weight: 600; color: #065f46;">
                                Tên đăng nhập
                            </label>
                            <InputText @bind-Value="Model.Username" class="form-control" disabled readonly
                                       style="border: 2px solid #d1fae5; border-radius: 8px; padding: 0.75rem 1rem; background-color: #f3f4f6;" />
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label" style="font-weight: 600; color: #065f46;">
                                Họ và tên <span style="color: #ef4444;">*</span>
                            </label>
                            <InputText @bind-Value="Model.FullName" class="form-control" placeholder="Nhập họ và tên..."
                                       style="border: 2px solid #d1fae5; border-radius: 8px; padding: 0.75rem 1rem;" />
                            <ValidationMessage For="@(() => Model.FullName)" class="text-danger mt-1" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label" style="font-weight: 600; color: #065f46;">
                                Chức vụ hiện tại
                            </label>
                            <input type="text" value="@(Model.Role == "admin" ? "Quản trị viên" : "Nhân viên")" 
                                    class="form-control" disabled readonly
                                    style="border: 2px solid #d1fae5; border-radius: 8px; padding: 0.75rem 1rem; background-color: #f3f4f6;" />
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label" style="font-weight: 600; color: #065f46;">
                                Trạng thái tài khoản
                            </label>
                            <!-- KHÓA HOÀN TOÀN: Không ai được sửa, kể cả admin -->
                            <input type="text" value="@(Model.Status == 1 ? "Hoạt động" : "Tạm ngưng")" 
                                    class="form-control" disabled readonly
                                    style="border: 2px solid #d1fae5; border-radius: 8px; padding: 0.75rem 1rem; background-color: #f3f4f6;" />
                        </div>
                    </div>

                    <hr class="my-4" />

                    <h5 class="mb-3" style="color: #065f46; font-weight: 600;">Đổi mật khẩu (để trống nếu không muốn đổi)</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label" style="font-weight: 600; color: #065f46;">
                                Mật khẩu mới
                            </label>
                            <InputText @bind-Value="NewPassword" type="password" class="form-control" placeholder="Nhập mật khẩu mới..."
                                       style="border: 2px solid #d1fae5; border-radius: 8px; padding: 0.75rem 1rem;" />
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label" style="font-weight: 600; color: #065f46;">
                                Xác nhận mật khẩu
                            </label>
                            <InputText @bind-Value="ConfirmPassword" type="password" class="form-control" placeholder="Nhập lại mật khẩu..."
                                       style="border: 2px solid #d1fae5; border-radius: 8px; padding: 0.75rem 1rem;" />
                            @if (!string.IsNullOrEmpty(PasswordError))
                            {
                                <span class="text-danger mt-1 d-block" style="font-size: 13px;">
                                    <i class="fas fa-exclamation-triangle"></i> @PasswordError
                                </span>
                            }
                        </div>
                    </div>

                    @if (!string.IsNullOrEmpty(SuccessMessage))
                    {
                        <div class="alert alert-success mt-3">@SuccessMessage</div>
                    }
                    @if (!string.IsNullOrEmpty(ErrorMessage))
                    {
                        <div class="alert alert-danger mt-3">@ErrorMessage</div>
                    }
                </div>

                <!-- Footer -->
                <div class="modal-footer" style="border-top: 1px solid #e5e7eb; padding: 1.5rem;">
                    <button type="button" class="btn" data-bs-dismiss="modal"
                            style="background-color: #e5e7eb; color: #374151; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600;">
                        Hủy
                    </button>
                    <button type="submit" class="btn btn-add"
                            style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600;">
                        <i class="fas fa-save"></i> Lưu thay đổi
                    </button>
                </div>
            </EditForm>
        </div>
    </div>
</div>